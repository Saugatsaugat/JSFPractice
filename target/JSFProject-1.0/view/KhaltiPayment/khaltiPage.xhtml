<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<ui:composition xmlns="http://www.w3c.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>
        <script src="https://khalti.s3.ap-south-1.amazonaws.com/KPG/dist/2020.12.17.0.0.0/khalti-checkout.iffe.js"></script>
    </h:head>

    <h:body>
        <h:form id="khaltiForm">
            <p:outputLabel style="display: none;" id="amountValue" value="#{bookingDetailController.getBookingAmount()}" />
            <p:panelGrid columns="2">
                <p:commandButton id="paymentButton" value="Khalti" icon="fa fa-money" onclick="startPayment()" />
                <p:commandButton id="esewa" value="Esewa Pay" title="Coming Soon..." onclick="comingSoon()" />

            </p:panelGrid>
        </h:form>
        <script type="text/javascript">
            function startPayment() {
                var config = {
                    // replace the publicKey with yours
                    "publicKey": "test_public_key_dc74e0fd57cb46cd93832aee0a390234",
                    "productIdentity": "1234567890",
                    "productName": "Dragon",
                    "productUrl": "http://gameofthrones.wikia.com/wiki/Dragons",
                    "paymentPreference": [
                        "KHALTI",
                        "EBANKING",
                        "MOBILE_BANKING",
                        "CONNECT_IPS",
                        "SCT",
                    ],
                    "eventHandler": {
                        onSuccess(payload) {
                            // hit merchant api for initiating verfication
                            console.log(payload);
                        },
                        onError(error) {
                            console.log(error);
                        },
                        onClose() {
                            console.log('widget is closing');
                        }
                    }
                };

                var checkout = new KhaltiCheckout(config);
                var amountValueElement = document.getElementById("khaltiForm:amountValue").textContent;
                checkout.show({amount: amountValueElement * 100});

            }


            //esewa
            function comingSoon() {
                alert("Esewa will be added soon. Thank you!");
            }

        </script>

    </h:body>


</ui:composition>
